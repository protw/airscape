# Центроїд гео точок

220817, OleghBond

Це черговий мій опус з обробки геоданих.

## Середовище

Особливість цього фрагменту в тому, що він створений у середовищі [*Google Colab*](https://colab.research.google.com/). Таким чином фактично я запускаю свої застосунки на зовнішньому сервері з допомогою [*Jupyter Notebook*](https://jupyter.org/) і *Python* без необхідності встановлювати у себе всі ці штуки. Як клієнту мені потрібний лише бравзер і обліковка в Google.

Середовище *Jupyter Notebook* корисно тим, що дає можливість вести власний код як rich formatted текст з використанням популярної мови розмітки [*Markdown*](https://gist.github.com/Jekins/2bf2d0638163f1294637), включно з математичними формулами в стилі [*LaTeX*](https://katex.org/docs/supported.html).

Підсумовуючи, можу сказати – це дуже зручна штука для складання прототипів або концептів у "похідних" умовах.

## Задача

Власне постановка завдання сформульована наступним чином:

Ви отримали звичайний ("плаский") текст, в якому в описі представлені географічні координати декількох точок. Вам потрібно швидко знайти центроїд (центр мас) всіх точок в тексті, оцінити розмір групи і відобразити все це на мапі.

Загальний порядок дій виглядатиме наступним чином:

1) простий інтерфейс для введення вхідних даних і параметрів
2) розбрати (parse) текст - знайти в ньому всі пари чисел (шир, довг) у певному визначеному форматі
3) знайти центроід знайдених точок та статистично визначений розмір групи
4) підготувати дані для зчитування
5) відобразити на карті точки і розмір області

## Рішення

Робочий діючий онлайн код представлений за [цією адресою](https://colab.research.google.com/drive/1yucRNSL4sPshdHIQgU1zwXfdbxYPwKRV). Для запуску коду потрібно спочатку залогінитись у Google, а потім підключити зовнішній сервер - праворуч вгорі є кнопка "*Підключитися*". Після підключення код можна запускати або в цілому або покроково: подивіться спадне меню "*Середовище виконання*" для ознайомлення з варіантами запуску.

Код складається з "клітинок" для запуску (власне виконавчий *Python* код) і блоку коментарів (*Markdown* текст). Ліворуч кожної клітинки запуску можна побачити значок типу `[ ]` або :arrow_forward:. Натиснувши цей значок ви запускаєте повністю всю клітинку коду.

У нашому випадку раджу запускати код послідовно покроково. Виконавчий код складається з декількох клітинок:

1. *Ініціалізація*

   Тут імпортуються потрібні модулі. **Цю клітинку достатньо запустити один раз на початку сесії.** Якщо сесія закрилась, наприклад, після тривалої паузи, то цю клітинку (як і всі нижче) треба запускати знову.

2. *Параметри розрахунків*

   Тут ви бачите декілька параметрів розрахунку, які можна міняти за потреби. **Як першого разу, так і після кожної зміни параметрів клітинку треба перезапустити.**

3. *Скопіюйте вхідний текст сюди*

   Сюди ви копіюєте вхідний текст, що містить координати декількох точок у визначених наперед форматах. Формат координат визначається параметром `coord_format` у розділі "*Параметри розрахунків*" вище. Приклади тексту для аналізу для різних форматів координат наведені у розділі коментарів "*Зразки вхідного тексту*". 

4. *Розрахунок*

   Тут все просто - запустили клітинку і побачили під нею результат розрахунку.

5. Візуалізація

   Тут теж все просто - запустили клітинку і побачили мапу з результатом.

Далі повертаєтесь до пункту 3 або, у разі зміни параметрів, до пункту 2.

## Виконавчий код

Кому цікаво. можуть подивитись вихідний код, а саме:

* Основний модуль — [airscape/centroid\_calc\_colab.ipynb at master · protw/airscape](https://github.com/protw/airscape/blob/master/stavok/gis/centroid/centroid_calc_colab.ipynb)
* Допоміжний модуль — [airscape/centroid\_util\_colab.py at master · protw/airscape](https://github.com/protw/airscape/blob/master/stavok/gis/centroid/centroid_util_colab.py)