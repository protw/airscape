# Матриця невідповідностей

Перед зануренням до вирішення задач класифікації (і не лише текстів) варто засвоїти поняття *матриці невідповідностей* і пов'язану із цим термінологією.

Цей матеріал підготовлений на базі статей:

1. [Простий посібник із термінології матриці невідповідностей](https://www.dataschool.io/simple-guide-to-confusion-matrix-terminology/) авторства *Kevin Markham* з [Data School](https://www.dataschool.io/).
2. [Матриця невідповідностей — Вікіпедія](https://uk.wikipedia.org/wiki/Матриця_невідповідностей)

Матриця невідповідностей - це таблиця, що часто використовується для **опису ефективності моделі класифікації** (або "класифікатора") для набору тестових даних, для яких відомі справжні значення. Сама матриця невідповідностей відносно проста для розуміння, але пов’язана з нею термінологія може заплутати.

Тому почнемо з прикладу матриці невідповідностей для бінарного класифікатора (хоча цей приклад можна легко розширити на випадок більш ніж двох класів):

|        N = 165         | Прогнозовано:<br />НІ | Прогнозовано:<br />ТАК |
| :--------------------: | :-------------------: | :--------------------: |
| **Насправді:<br/>НІ**  |          50           |           10           |
| **Насправді:<br/>ТАК** |           5           |          100           |

Чого ми можемо навчитися із цієї матриці?:

- Є два можливих прогнозованих класи: **ТАК** і **НІ**. Якби ми, наприклад, займались прогнозуванням наявності певного захворювання, то **ТАК** означало б, що пацієнти мають це захворювання, а **НІ** означало б, що вони не мають цього захворювання.
- Класифікатор зробив загалом 165 прогнозів (тобто 165 пацієнтів тестувалися на наявність цього захворювання).
- Із цих 165 випадків класифікатор передбачив **ТАК** 110 разів і **НІ** 55 разів (це суми по колонках таблиці).
- Хоча насправді 105 пацієнтів у вибірці мають захворювання, а 60 пацієнтів - ні (це суми по рядках таблиці).

Тепер визначимо основні терміни, яким відповідають цілі числа (це кількість випадків, про похідні показники буде трохи згодом):

|              Укр              |           Англ            | Пояснення                                                    | Примітка |
| :---------------------------: | :-----------------------: | ------------------------------------------------------------ | -------- |
| **істинно позитивні<br/>ІП** | **true positive<br/>TP** | ми передбачили **ТАК** (у пацієнтів є захворювання) і вони <u>насправді мають</u> це захворювання (**ТАК**) |          |
| **істинно негативні<br />ІН** | **true negative<br />TN** | ми передбачили **НІ**, і пацієнти <u>насправді не мають</u> цього захворювання (**НІ**) |          |
| **хибно-позитивні<br />ХП** | **false positive<br />FP** | ми передбачили **ТАК**, але <u>насправді у пацієнтів відсутнє</u> це захворювання (**НІ**) | ця помилка відома як "помилка типу І" |
| **хибно-негативні<br />ХН** | **false negative<br />FN** | ми передбачили **НІ**, але <u>насправді у пацієнтів є</u> це захворювання (**ТАК**) | ця помилка відома як "помилка типу ІІ" |

Також додамо ще два очевидних терміни:

- **позитивний стан** (**П** або **P**): число справжніх позитивних випадків у даних;
- **негативний стан** (**Н** або **N**): число справжніх негативних випадків у даних.

Тепер додамо ці терміни включно з підсумками рядків і стовпців до матриці невідповідностей:

| Прогнозовано :point_right:<br />Насправді :point_down: |           НІ           |           ТАК           |        РАЗОМ        |
| :----------------------------------------------------: | :--------------------: | :---------------------: | :-----------------: |
|                         **НІ**                         |    ІН = TN = **50**    |    ХП = FP = **10**     |   Н = N = **60**    |
|                        **ТАК**                         |    ХН = FN = **5**     |    ІП = TP = **100**    |   П = P = **105**   |
|                       **РАЗОМ**                        | ІН+ХН = TN+FN = **55** | ХП+ІП = FP+TP = **110** | Н+П = N+P = **165** |

## Показники ефективності класифікатора

Тепер можна перейти до деяких розповсюджених показників ефективності класифікатора:

| Термін                                                       | Визначення                                                   | Формула                                                      | Примітки                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **Точність<br />(Accuracy)**                                 | як часто класифікатор <br />видає правильний <br />результат | ДЕ = (ІП+ІН)/(Н+П) <br />= (TP+TN)/(N+P) <br />= (100+50)/165 = 0.91 | також відома як <br />"**діагностична <br />ефективність**" (**ДЕ**) |
| **Рівень <br />помилкової <br />класифікації <br />(Misclassification <br />Rate)** | як часто класифікатор <br />видає неправильний <br />результат | 1 - ДЕ <br />= (ХП+ХН)/(Н+П) <br />= (FP+FN)/(N + P) <br />= (10+5)/165 = 0.09 | також відомий як <br />"**частота помилок**" <br />("**Error Rate**") |
| **Істиннопозитивний<br/>рівень (True <br/>Positive Rate)**   | коли насправді **ТАК**, то <br />як часто класифікатор <br />передбачає **ТАК** | ІПР = ІП/(ІП+ХН) <br />= TP/(TP+FN) <br />= 100/105 = 0.95   | також відомий як <br />"**чутливість**" <br />("**Sensitivity**" або <br />"**Recall**") |
| **Хибнопозитивний<br/>рівень (False <br/>Positive Rate)**    | коли насправді **НІ**, то <br />як часто класифікатор<br />передбачає **ТАК** | ХПР = 1 - ІНР <br />= ХП/(ХП+ІН) <br />= FP/(FP+TN) <br />= 10/60 = 0.17 | також відомий як <br />"**побічний продукт**"                |
| **Істиннонегативний<br/>рівень (True <br/>Negative Rate)**   | коли насправді **НІ**, то <br />як часто класифікатор <br />передбачає **НІ** | ІНР = 1 - ХПР <br />= ІН/(ІН + ХП) <br />= TN/(TN+FP) <br />= 50/60 = 0.83 | також відомий як <br />"**діагностична <br />специфічність**" <br />("**Specificity**") |
| **Влучність <br />(Precision)**                              | коли класифікатор <br />прогнозує **ТАК**, то як <br />часто він робить це <br />правильно | ПЗ+ = ІП/(ІП + ХП) <br />= TP/(TP+FP) <br />= 100/110 = 0.91 | відома також як <br />"**прогностична <br />значущість <br />позитивного <br />результату**" (**ПЗ+**) |

