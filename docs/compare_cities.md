# Порівнюємо міста

Почнімо читання даних Твіттера для подальшого збирання і накопичення.

```python
import twint
import pandas as pd

import nest_asyncio
nest_asyncio.apply()
```

Оберемо один день для збирання твітів, наприклад: `2021-09-25`, у трьох містах: Київ, Краків і Лондон. У кожному з міст оберемо найбільш притаманну мову. Це виглядатиме таким чином:

```python
cities = [
    {'c':'kyiv',  'l':['uk','ru']},
    {'c':'krakow','l':['']},
    {'c':'london','l':['en']}]
start_time = '2021-09-25'
end_time = '2021-09-26'
```

Під час зчитування 

- обиратимемо твіти з географічною прив'язкою до конкретного міста, що дозволяє оператор Твіттера `near:`; у *Twint* це забезпечує атрибут конфігурації `.Near`;
- приглушуємо виведення з допомогою атрибуту `.Hide_output`;
- також виводимо кількість зчитаних твітів та використовуємо модуль *Pandas* для збереження зчитаних твітів.

Код для читання виглядає так:

```python
def read_save_twits(city,lang):
    c = twint.Config()

    c.Near         = city
    c.Since        = start_time
    c.Until        = end_time
    c.Hide_output  = True
    c.Count        = True
    c.Pandas       = True
    c.Store_pandas = True
    if lang != 'all':
        c.Lang     = lang

    twint.run.Search(c)

    Tweets_df = twint.storage.panda.Tweets_df
    num_of_tweets = len(Tweets_df)
    if num_of_tweets != 0:
        file = f"{''.join(start_time.split('-'))[2:8]}-{city}-{lang}.csv" 
        Tweets_df.to_csv(file, sep=',', decimal='.', encoding="utf-8-sig",
                         index=False)
    return num_of_tweets

for city in cities:
    c = city['c']
    for lang in city['l']:
        if len(lang) == 0: 
            lang = 'all'
        num_of_tweets = read_save_twits(c,lang)
        print(f'Місто: {c}, мова: {lang} - {num_of_tweets} твітів')
```

Код цього прикладу тут - [cities.py](https://github.com/protw/airscape/blob/master/src/cities.py).

Підведемо підсумки - кількість твітів з географічною прив'язкою, опублікованих за добу  `2021-09-25` :

| Місто  |    Мови    | Кількість<br />твітів |                     Населення, <br />млн                     | Твітів на 1 млн <br />населення на добу | Відносний<br />рівень, % |
| :----: | :--------: | :-------------------: | :----------------------------------------------------------: | :-------------------------------------: | :----------------------: |
| Лондон |    `en`    |         17085         | [8.4](https://uk.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BC%D1%96%D1%81%D1%82_%D0%B7%D0%B0_%D1%87%D0%B8%D1%81%D0%B5%D0%BB%D1%8C%D0%BD%D1%96%D1%81%D1%82%D1%8E_%D0%BD%D0%B0%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F) |                  2034                   |           100%           |
| Краків | всі наявні |          551          | [0.78](https://uk.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D0%BA%D1%96%D0%B2) |                   706                   |           35%            |
|  Київ  | `uk`, `ru` |          41           | [3.0](https://uk.wikipedia.org/wiki/%D0%9D%D0%B0%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%BD%D1%8F_%D0%9A%D0%B8%D1%94%D0%B2%D0%B0) |                   14                    |           0.7%           |

З якісної точки зору результат очікуваний і майже очевидний - Твіттер ширше розповсюджений у країнах Західної Європи і Північної Америки.

Тут важливо зазначити, що відображена тут кількість твітів є незначною часткою всіх опублікованих твітів у цих містах. Наразі немає повного розуміння чи то є геотаговані твіти, чи то інформація про розташування публікації отримана за IP-адресою користувача. За думкою експертів частка лише геотагованих твітів складає біля 1%.

## Висновок

На жаль добова інтенсивність публікації твітів з географічною прив'язкою на теренах України явно недостатня для для цілей отримання екологічних оцінок, враховуючи те, що кількість екологічно спрямованих твітів складає лише певну невелику частку від кількості твітів з географічною прив'язкою, яку ще треба дослідити.

Подумаємо, що робити:

1. шукати інші інтенсивні джерела регулярної текстової інформації з географічною прив'язкою;
2. випробовувати методи визначення географічної прив'язки шляхом аналізу текстів та інших атрибутів твітів (постів).
